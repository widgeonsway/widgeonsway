<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agile</title>
  <link rel="icon" href="logo/widgeons-way-website-favicon-color.png">
    <link rel="icon" href="logo/widgeons-way-website-favicon-color.png" sizes="">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <link rel="icon" href="img/widgeonswaylogo.png" />
   
    <link href="/css/general.css" rel="stylesheet">  
     <link href="/css/queries.css" rel="stylesheet"> 
     <link href="/css/walkthroughs.css" rel="stylesheet"> 
 
    
    <script src="https://code.iconify.design/iconify-icon/1.0.5/iconify-icon.min.js"></script>
</head>
<body>
    <header class="header ">
      <a href="/">
        <img class="logo" alt="Widgeon's Way Logo" src="/img/widgeonswaylogo.png"/>
      </a>

      <nav class="main-nav " id="menulinks">
        <ul class="main-nav-list">
          <li><a class="main-nav-link" href="/">Home</a></li>
          
          <li>
            <a class="main-nav-link" href="/playbook/">Play Book</a>
          </li>
          <li><a class="main-nav-link" href="/walkthroughs/">Walk-Throughs</a></li>
          <li><a class="main-nav-link" href="/widgeon-ctf/">Widgeon CTF</a></li>
          <li><a class="main-nav-link nav-cta" href="/about/">About</a></li>
        </ul>
      </nav>
      <button class="btn-mobile-nav">
        <i class="icon-mobile-nav fa-solid fa-bars"></i>
        <i class="icon-mobile-nav fa-solid fa-x"></i>
        
      
      </button>
    </header>
        <main class="container"id="walkthrough">    
            <div class="content">
                <p class="walkthrough-date">March 6, 2023</p>
                
                        <h1 class="header-primary-walkthrough">Agile</h1>
                     
        
                        <h3 class="header-tertiary-walkthrough center-text">Tools Needed: Gobuster, LinPEAS, Burp Suite and Chisel.</h3>
                        <p class="description center-text">Disclaimer: This method has since been patched</p>
         
            
            <img class="walkthrough-img" id="small" src="./img/Picture1.png" alt="Agile Cover Photo">
       
          
                <h2 class="header-secondary-walkthrough">Step 1: Start off with an Nmap Scan</h2>       
                <!-- <p class="description">Start off with an nmap scan</p> -->
             
                <p class="walkthrough-copy"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-copy"></i></button><code>nmap -sV -sC &lt;IP ADDRESS&gt; -oA &lt;FILE NAME&gt;</code></p>
                <img class="walkthrough-img" src="./img/Picture2.png" alt="Nmap Scan">
  
              <p class="description">We can see that this room redirects to superpass.htb, we can add that to our /etc/hosts and then navigate to the webpage</p>
              <img class="walkthrough-img" src="./img/Picture3.png" alt="/etc/hosts">
              <img class="walkthrough-img" src="./img/Picture4.png" alt="Superpass Homepage">
              <p class="description">This will scan for any directories that come after the main website:</p>
              <p class="walkthrough-copy"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-copy"></i></button>gobuster dir -u http://superpass.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</p>
              <img class="walkthrough-img" src="./img/Picture5.png" alt="Gobuster Scan">
              <p class="description">This one will scan for any vhosts:</p>
              <p class="walkthrough-copy"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-copy"></i></button>gobuster vhost -u http://superpass.htb/ -w /usr/share/seclists/Discovery/DNS/subdomains-
                top1million-5000.txt –append-domain
                </p>
                <img class="walkthrough-img" src="./img/Picture6.png" alt="Gobuster Scan">

                <p class="description">No vhosts are found. </p>
                <p class="description">Go back to the website and register for an account </p>
                <img class="walkthrough-img" src="./img/Picture7.png" alt="Register for an account">
                <p class="description">You will be redirected to an error page. </p>
                <img class="walkthrough-img" src="./img/Picture8.png" alt="Error page">
                <!-- <img class="walkthrough-img" src="../img/agile/Picture9.png" alt="Error page"> -->
                <p class="description">From the gobuster scan we can go to superpass.htb/download. </p>
                <img class="walkthrough-img" src="./img/Picture10.png" alt="Error page">
                <img class="walkthrough-img" src="./img/Picture11.png" alt="Error page">
                <img class="walkthrough-img" src="./img/Picture12.png" alt="Burp Suite">
                <img class="walkthrough-img" src="./img/Picture13.png" alt="Burp Suite">
                <p class="description">You can see here that certain functions get ran on this page if you add a ? followed by the commands.</p>
<p class="description">So, we can attempt to call the function specified in download to try to get something from the web server.</p>
<p class="description">Very Linux.</p>

<p class="description">To test this download function, I tried a test.</p>
<img class="walkthrough-img" src="./img/Picture14.png" alt="Burp Suite request test">

<p class="description">We can see that it’s checking the /tmp directory for the file test.</p>
<p class="description">So we can try doing some directory traversal to get a file we know exists on Linux systems.</p>
<img class="walkthrough-img" src="./img/Picture15.png" alt="Burp Suite">

<p class="description">And we have a few potential usernames here</p>
<img class="walkthrough-img" src="./img/Picture16.png" alt="Burp Suite">







<p class="description">Corum. Runner, Edwards, dev_admin</p>

<p class="description">Next, we want to go read more about this application.</p>
<p class="description">We can find the paths to many of the files in that initial error we found when registering for the website.</p>

<p class="description">Next let's read the file we found in the download function.</p>
<img class="walkthrough-img" src="./img/Picture17.png" alt="Gobuster Scan">

<p class="description">We can find a directory for a vault with an ID.</p>
<img class="walkthrough-img" src="./img/Picture18.png" alt="Gobuster Scan">

<p class="description">Going to this URL gives us a blank page, but not an error like other places.</p>
<img class="walkthrough-img" src="./img/Picture19.png" alt="Gobuster Scan">

<p class="description">We can create a simple wordlist to attempt to go through these vaults (I manually typed numbers 1-20 to test)</p>
<p class="description">Send this request to intruder</p>

<img class="walkthrough-img" src="./img/Picture20.png" alt="Gobuster Scan">

<p class="description">Clear the $$$</p>

<img class="walkthrough-img" src="./img/Picture21.png" alt="Gobuster Scan">

<p class="description">And add the position of the payload</p>

<img class="walkthrough-img" src="./img/Picture22.png" alt="Gobuster Scan">

<p class="description">Go to payloads, under payload options load a wordlist of numbers. And start your attack.</p>
<p class="description">Look at the length of the responses to see which ones are unique</p>

<img class="walkthrough-img" src="./img/Picture23.png" alt="Gobuster Scan">

<img class="walkthrough-img" src="./img/Picture24.png" alt="Gobuster Scan">

<p class="description">Or visit the page</p>


<img class="walkthrough-img" src="./img/Picture25.png" alt="Gobuster Scan">
<p class="description">And these are the SSH credentials</p>
<img class="walkthrough-img" src="./img/Picture26.png" alt="Gobuster Scan">
<img class="walkthrough-img" src="./img/Picture27.png" alt="Gobuster Scan">
<p class="description">Next thing to do is sudo -l to see what this user can run as sudo.</p>

<img class="walkthrough-img" src="./img/Picture28.png" alt="Gobuster Scan">

<p class="description">Nothing, moving on to linPEAS</p>

<p class="description">Now we can try linPEAS. Curling directly from the target does not work so we can get linPEAS on our host and then start a python server to download it that way.</p>
<img class="walkthrough-img" src="./img/Picture29.png" alt="Gobuster Scan">

<img class="walkthrough-img" src="./img/Picture30.png" alt="Gobuster Scan">
<p class="description">Do not forget to chmod the file and then you can run it.</p>

<img class="walkthrough-img" src="./img/Picture31.png" alt="Gobuster Scan">


<img class="walkthrough-img" src="./img/Picture32.png" alt="Gobuster Scan">




<p class="description">Let's forward this debugging port to ourselves so we can look if there’s any additional information on there.</p>
<p class="description">To do this we’re going to use a tool named chisel.</p>
<p class="walkthrough-copy"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-copy"></i></button><a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a></p>
<p class="description">This will let us create a tunnel from the target to our machine and use this debugger.</p>
<p class="description">We’re going to have to get this on our host machine and upload it to the Agile box.</p>
<img class="walkthrough-img" src="./img/Picture33.png" alt="curl Scan">
<img class="walkthrough-img" src="./img/Picture34.png" alt="wget chisel">

<img class="walkthrough-img" src="./img/Picture35.png" alt="chmod chisel">

<img class="walkthrough-img" src="./img/Picture38.png" alt="chisel">
<img class="walkthrough-img" src="./img/Picture104.png" alt="Dev tools">
<p class="description">Next step is to open a Chrome-based browser and go to chrome://inspect</p>
<p class="description">We should have gotten a page by navigating to localhost:port</p>
<img class="walkthrough-img" src="./img/Picture103.png" alt="localhost">
<p class="description">But we got nothing!</p>
<p class="description">Let’s check the netstat of Agile to see if we can get any more information</p>
<img class="walkthrough-img" src="./img/Picture39.png" alt="netstat">

<p class="description">Only 5555 seems to have given us any results from ps, so we can try that port</p>
<img class="walkthrough-img" src="./img/Picture40.png" alt="ps aux">
<img class="walkthrough-img" src="./img/Picture41.png" alt="chisel">
<p class="description">We get something back from Agile on our chisel server</p>
<img class="walkthrough-img" src="./img/Picture42.png" alt="Chisel">
<p class="description">So, let’s reconfigure our Chrome inspect to use 5555</p>
<p class="description">And let’s go check out the website!</p>
<img class="walkthrough-img" src="./img/Picture43.png" alt="SuperPassword">

<p class="description">Trying to log in, but we get a different error this time</p>
<img class="walkthrough-img" src="./img/Picture44.png" alt="Internal Server Error">


<p class="description">Second attempt</p>
<img class="walkthrough-img" src="./img/Picture45.png" alt="Second Attempt">


<p class="description">Going to try to register as a new user</p>
<img class="walkthrough-img" src="./img/Picture46.png" alt="Register a user">


<p class="description">I went to the spot where we found Corum’s credentials, but this time the page is blank, so I decided to retry the IDOR enumeration.</p>
<p class="description">This time I did it manually because it was under ten.</p>
<p class="description">We get booted to the login page, which was not the same functionality as before.</p>
<img class="walkthrough-img" src="./img/Picture47.png" alt="Login page">

<p class="description">We continue through the vault rows and on 1 we get Edwards credentials</p>
<img class="walkthrough-img" src="./img/Picture48.png" alt="Edwards Credentials">


<p class="description">Now we can try to SSH into the machine as Edwards.</p>
<img class="walkthrough-img" src="./img/Picture49.png" alt="ssh as edwards">
<p class="description">Run sudo -l to see what Edwards can run as sudo</p>
<img class="walkthrough-img" src="./img/Picture50.png" alt="sudo -l">


<p class="description">Edwards can sudoedit the following two files:</p>
<p class="description">/app/config_test.json</p>
<img class="walkthrough-img" src="./img/Picture51.png" alt="Edwards sudoedit">

<p class="description">And /app/app-testing/tests/functional/creds.txt</p>
<img class="walkthrough-img" src="./img/Picture52.png" alt="creds.txt">

<p class="description">We should check what version of sudoedit it is using.</p>
<img class="walkthrough-img" src="./img/Picture53.png" alt="sudoedit -v">

<p class="description">Googling sudoedit and the version number will get us to CVE-2023-22809.</p>
<p class="description">Here is a GitHub with an exploit to use:</p>
<p class="walkthrough-copy"><button class="copy-btn" onclick="copyToClipboard(this)"><i class="fa-solid fa-copy"></i></button><a href="https://github.com/n3m1dotsys/CVE-2023-22809-sudoedit-privesc/blob/main/exploit.sh">https://github.com/n3m1dotsys/CVE-2023-22809-sudoedit-privesc/blob/main/exploit.sh</a></p>
<img class="walkthrough-img" src="./img/Picture54.png" alt="Using wget to put linpeas onto target machine">

<p class="description">Looking for anything interesting in linPEAS</p>
<img class="walkthrough-img" src="./img/Picture55.png" alt="Linpeas results">
<p class="description">We can read these files but not write to them.</p>
<img class="walkthrough-img" src="./img/Picture56.png" alt="Results showing that we can read but not write files">

<p class="description">This script will execute source /app/venv/bin/activate</p>
<p class="description">We can try writing to that file with the sudoedit CVE and attempt to get the root flag that way</p>
<img class="walkthrough-img" src="./img/Picture57.png" alt="Attempt to write to file">

<p class="description">This time when we try to sudoedit the /app/config_test.json, it was fine, it will open up the activate file instead</p>
<img class="walkthrough-img" src="./img/Picture58.png" alt="sudo edit /app/config">

<p class="description">Let's do a test to see if we can read the root flag</p>
<img class="walkthrough-img" src="./img/Picture59.png" alt="chmod test">

<p class="description">Looks like the file saved when we quit.</p>
<img class="walkthrough-img" src="./img/Picture60.png" alt="cat /app/venv/bin/activate">

<p class="description">If the comments in the script are correct we should soon source the activate file and it should execute our cat root/root.txt flag command.</p>
<p class="description">So we can go to /tmp and wait for the file to show up</p>
<img class="walkthrough-img" src="./img/Picture61.png" alt="ls results">
<p class="description">We can then read our file</p>
<img class="walkthrough-img" src="./img/Picture62.png" alt="Root.txt">
<p class="description">Success! Agile has been pwned 😎</p>
<img class="walkthrough-img" src="./img/Picture63.png" alt="Agile has been pwned">
            
           
            
        </div>        

           
        <aside class="aside-suggestions">
          <h2 class="header-secondary-walkthrough">Related Walkthroughs</h2>
          <ul>
            <li><a href="/walkthroughs/post1">Getting Foothold on BasicLinux</a></li>
            <li><a href="/walkthroughs/post2">TikiVault Priv Esc Steps</a></li>
            <li><a href="/walkthroughs/post3">Rooting CrumbleBox</a></li>
          </ul>
        </aside>
            
      
    

  
</main>
  <!------------------- Footer ------------------->
  <footer class="footer center-text" >
    <div class="center-text grid grid--3-cols">
      
        <div class="footer__navigation">
          <ul class="footer__list">
            <li class="footer__item"><a href="https://github.com/widgeonsway" class="footer__link"><i class="fab fa-github"></a></i></li>
            <li class="footer__item"><a href="https://tryhackme.com/p/widgeon" class="footer__link"><iconify-icon icon="simple-icons:tryhackme"></a></iconify-icon></li>
            <li class="footer__item"><a href="https://app.hackthebox.com/users/1201996" class="footer__link"><iconify-icon icon="simple-icons:hackthebox"></a></iconify-icon>
            <li class="footer__item"><a href="https://www.linkedin.com/in/stormypleym/" class="footer__link"><i class="fa-brands fa-linkedin"></i>
            <li class="footer__item"><a href="mailto:stormy.pleym@gmail.com" class="footer__link"><i class="fa-solid fa-envelope"></a></i></li>
          </ul>
        </div>
      <div class="footer__logo-box ">
       <span>Widgeon's Way</span>
        <p class="center-text">Thank you</p>
        <p class="center-text">Made by <img class="duck" src="/img/widgeonswaylogo.png" width="18" height="18"><a href="about.html"> Widgeon</a></p>
      </div>
      
      <div class="copyright">
        Copyright &copy; <span class="year">2027 </span> Widgeon's Way
       
      </div>
      
    </div>
    <button onclick="scrollToTop()" id="topBtn" title="Go to top">
      Back to top
    </button>
    
    </footer>

    <script src="https://code.iconify.design/iconify-icon/1.0.5/iconify-icon.min.js"></script>
    <script src="/scripts/script.js"></script>
    <script>
        function copyToClipboard(button) {
            const text = button.parentElement.textContent.trim();
            navigator.clipboard.writeText(text).then(() => {
                button.innerHTML = '<i class="fa-solid fa-check"></i>'; 
                setTimeout(() => button.innerHTML = '<i class="fa-solid fa-copy"></i>', 2000); 
            }).catch(err => console.error('Error copying text:', err));
        }
        </script>
 
  </body>

    
 
</body>
</html>

